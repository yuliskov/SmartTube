name: VirusTotal Scan on Release

on:
  release:
    types: [published]

jobs:
  virustotal_scan:
    permissions:
      contents: write
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download Release Assets
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          mkdir -p release_assets
          # –°–∫–∞—á–∏–≤–∞–µ–º –≤—Å–µ APK –∏–∑ —Ä–µ–ª–∏–∑–∞
          gh release download ${{ github.event.release.tag_name }} --dir release_assets --pattern "*.apk"
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–Ω–∏ –µ—Å—Ç—å
          ls -l release_assets

      - name: Scan APKs with VirusTotal
        uses: cssnr/virustotal-action@v1
        with:
          vt_api_key: ${{ secrets.VIRUS_TOTAL_API_KEY }}
          # –°–∫–∞–Ω–∏—Ä—É–µ–º –≤—Å–µ APK –≤ –ø–∞–ø–∫–µ
          file_globs: release_assets/*.apk
          summary: true
          update_release: true
          release_heading: 'üõ°Ô∏è VirusTotal Scan Results:'
          wait: true

      - name: Print Scan Completed
        run: echo "VirusTotal scan finished for all APKs."
