name: VirusTotal Scan on Release

on:
  release:
    types: [published]

jobs:
  virustotal_scan:
    permissions:
      contents: write 
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download Release Assets
        uses: actions/download-release-asset@v1 
        with:
          release_id: ${{ github.event.release.id }} 
          path: ./release_assets
          github_token: ${{ secrets.GITHUB_TOKEN }}

      - name: VirusTotal Scan
        uses: cssnr/virustotal-action@v1 
        with:
          vt_api_key: ${{ secrets.VIRUS_TOTAL_API_KEY }}
          file_globs: |
            ./release_assets/*.apk
          
          summary: true 
          update_release: true 
          release_heading: 'üõ°Ô∏è VirusTotal Scan Results:'