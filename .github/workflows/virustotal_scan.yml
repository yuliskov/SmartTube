name: VirusTotal Scan on Release

on:
  release:
    types: [published]

jobs:
  virustotal_scan:
    permissions:
      contents: write 
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download Release Assets
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          mkdir -p release_assets
          gh release download ${{ github.event.release.tag_name }} --dir ./release_assets --pattern "*"


      - name: VirusTotal Scan
        uses: cssnr/virustotal-action@v1 
        with:
          vt_api_key: ${{ secrets.VIRUS_TOTAL_API_KEY }}
          file_globs: |
            ./release_assets/*.apk
          
          summary: true 
          update_release: true 
          release_heading: 'üõ°Ô∏è VirusTotal Scan Results:'